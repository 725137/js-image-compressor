!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImageCompressor=t():e.ImageCompressor=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i=window,r=/^image\//,o=/\.\w+$/,a={},s={file:null,quality:.8,convertSize:2e6,loose:!0},f=function(e){return"function"==typeof e},l=function(e){return r.test(e)};function u(e){e=Object.assign({},s,e),this.options=e,this.file=e.file,this.image=null,this.init()}var c=u.prototype;for(var h in t.default=u,c.init=function(){var e=this,t=this.file,n=this.options;t&&l(t.type)?(l(n.mimeType)||(n.mimeType=t.type),a.file2Image(t,(function(i){f(e.beforeCompress)&&(e.image=i,t.width=i.naturalWidth,t.height=i.naturalHeight,e.beforeCompress(t));var r=e.getExpectedEdge(),o=a.image2Canvas(i,r.width,r.height,e.beforeDraw.bind(e),e.afterDraw.bind(e));a.canvas2Blob(o,(function(t){t.width=o.width,t.height=o.height,e.success(t)}),n.quality,n.mimeType)}),e.error)):e.error("请上传图片文件!")},c.beforeCompress=function(){f(this.options.beforeCompress)&&this.options.beforeCompress(this.file)},c.getExpectedEdge=function(){var e=this.image,t=this.options,n=e.naturalWidth,i=e.naturalHeight,r=n/i,o=Math.max(t.maxWidth,0)||1/0,a=Math.max(t.maxHeight,0)||1/0,s=Math.max(t.minWidth,0)||0,f=Math.max(t.minHeight,0)||0,l=Math.max(t.width,0)||n,u=Math.max(t.height,0)||i;return o<1/0&&a<1/0?a*r>o?a=o/r:o=a*r:o<1/0?a=o/r:a<1/0&&(o=a*r),s>0&&f>0?f*r>s?f=s/r:s=f*r:s>0?f=s/r:f>0&&(s=f*r),u*r>l?u=l/r:l=u*r,{width:l=Math.floor(Math.min(Math.max(l,s),o)),height:u=Math.floor(Math.min(Math.max(u,f),a))}},c.beforeDraw=function(e,t){var n=this.file,i=this.options,r="transparent";n.size>i.convertSize&&"image/png"===i.mimeType&&(r="#fff",i.mimeType="image/jpeg"),e.fillStyle=r,e.fillRect(0,0,t.width,t.height),f(i.beforeDraw)&&i.beforeDraw.call(this,e,t)},c.afterDraw=function(e,t){var n=this.options;f(n.afterDraw)&&n.afterDraw.call(this,e,t)},c.error=function(e){var t=this.options;if(!f(t.error))throw new Error(e);t.error.call(this,e)},c.success=function(e){var t,n,i=this.options,r=this.file,a=this.image,s=this.getExpectedEdge(),u=a.naturalHeight,c=a.naturalWidth;if(e)if(!i.loose&&e.size>r.size&&!(s.width>c||s.height>u))e=r;else{const i=new Date;e.lastModified=i.getTime(),e.lastModifiedDate=i,e.name=r.name,e.name&&e.type!==r.type&&(e.name=e.name.replace(o,(t=e.type,"jpeg"===(n=l(t)?t.substr(6):"")&&(n="jpg"),"."+n)))}else e=r;f(i.success)&&i.success.call(this,e)},a.file2DataUrl=function(e,t,n){var i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(){f(n)&&n("读取文件失败！")},i.readAsDataURL(e)},a.file2Image=function(e,t,n){var r=new Image,o=i.URL||i.webkitURL;if(i.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(i.navigator.userAgent)&&(r.crossOrigin="anonymous"),r.alt=e.name,r.onerror=function(){f(n)&&n("图片加载错误！")},o){var a=o.createObjectURL(e);r.onload=function(){t(r),o.revokeObjectURL(a)},r.src=a}else this.file2DataUrl(e,(function(e){r.onload=function(){t(r)},r.src=e}),n)},a.url2Image=function(e,t,n){var i=new Image;i.src=e,i.onload=function(){t(i)},i.onerror=function(){f(n)&&n("图片加载错误！")}},a.image2Canvas=function(e,t,n,i,r){var o=document.createElement("canvas"),a=o.getContext("2d");return o.width=t||e.naturalWidth,o.height=n||e.naturalHeight,f(i)&&i(a,o),a.save(),a.drawImage(e,0,0,o.width,o.height),a.restore(),f(r)&&r(a,o),o},a.canvas2DataUrl=function(e,t,n){return e.toDataURL(n||"image/jpeg",t)},a.dataUrl2Image=function(e,t,n){var i=new Image;i.onload=function(){t(i)},i.error=function(){f(n)&&n("图片加载错误！")},i.src=e},a.dataUrl2Blob=function(e,t){for(var n=e.split(",")[1],i=e.match(/^data:(.*?)(;base64)?,/)[1],r=atob(n),o=n.length,a=new Uint8Array(o),s=0;s<o;s++)a[s]=r.charCodeAt(s);return new Blob([a],{type:t||i})},a.blob2DataUrl=function(e,t,n){this.file2DataUrl(e,t,n)},a.blob2Image=function(e,t,n){this.file2Image(e,t,n)},a.canvas2Blob=function(e,t,n,i){var r=this;HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){let i=this.toDataURL(t,n);e(r.dataUrl2Blob(i))}}),e.toBlob((function(e){t(e)}),i||"image/jpeg",n||.8)},a.upload=function(e,t,n){var i=new XMLHttpRequest,r=new FormData;r.append("file",t),i.onreadystatechange=function(){if(4!==i.readyState||200!==i.status)throw new Error(i);n&&n(i.responseText)},i.open("POST",e,!0),i.send(r)},a)a.hasOwnProperty(h)&&(u[h]=a[h])}]).default}));